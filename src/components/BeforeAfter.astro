---
// src/components/BeforeAfter.astro
interface Props {
  beforeImage: string;
  afterImage: string;
  alt: string;
}

const { beforeImage, afterImage, alt } = Astro.props;
---

<div class="relative w-full max-w-5xl mx-auto aspect-video rounded-xl overflow-hidden shadow-2xl select-none group before-after-container">
  <img 
    src={afterImage} 
    alt={`After: ${alt}`} 
    class="absolute inset-0 w-full h-full object-cover"
    draggable="false"
  />
  
  <span class="absolute top-4 right-4 bg-neutral-deep/80 text-white px-3 py-1 text-sm font-bold rounded backdrop-blur-sm z-10">
    AFTER
  </span>

  <div class="absolute inset-0 w-1/2 overflow-hidden before-layer">
    <img 
      src={beforeImage} 
      alt={`Before: ${alt}`} 
      class="absolute inset-0 w-[200%] max-w-none h-full object-cover" 
      draggable="false"
    />
    <span class="absolute top-4 left-4 bg-neutral-deep/80 text-white px-3 py-1 text-sm font-bold rounded backdrop-blur-sm z-10">
      BEFORE
    </span>
  </div>

  <div class="absolute inset-y-0 left-1/2 w-1 bg-white cursor-ew-resize hover:bg-primary transition-colors slider-handle z-20">
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-lg border-2 border-primary">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
        <path d="m9 18-6-6 6-6"/>
        <path d="m15 6 6 6-6 6"/>
      </svg>
    </div>
  </div>
</div>

<script>
  // Lógica del Slider (Mouse + Touch)
  const containers = document.querySelectorAll('.before-after-container');

  containers.forEach(container => {
    const sliderHandle = container.querySelector('.slider-handle') as HTMLElement;
    const beforeLayer = container.querySelector('.before-layer') as HTMLElement;
    const beforeImage = beforeLayer.querySelector('img') as HTMLElement;
    
    let isDragging = false;

    const updateSlider = (x: number) => {
      const rect = container.getBoundingClientRect();
      // Calcular porcentaje (0 a 100)
      let position = ((x - rect.left) / rect.width) * 100;
      
      // Limitar entre 0% y 100%
      position = Math.max(0, Math.min(100, position));

      // Aplicar estilos
      sliderHandle.style.left = `${position}%`;
      beforeLayer.style.width = `${position}%`;
      // La imagen interna debe moverse inversamente para mantenerse "fija" visualmente
      beforeImage.style.width = `${10000 / position}%`; 
    };

    // Eventos Mouse
    container.addEventListener('mousedown', () => isDragging = true);
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateSlider(e.clientX);
    });

    // Eventos Touch (Móvil)
    container.addEventListener('touchstart', () => isDragging = true);
    window.addEventListener('touchend', () => isDragging = false);
    window.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      // Prevenir scroll mientras se desliza
      e.preventDefault(); 
      updateSlider((e as TouchEvent).touches[0].clientX);
    });
  });
</script>